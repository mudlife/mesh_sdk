C51 COMPILER V9.53.0.0   OS                                                                07/19/2019 10:23:34 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE OS
OBJECT MODULE PLACED IN .\Objects\os.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE os\os.c LARGE OPTIMIZE(6,SPEED) INCDIR(.\app;.\dev;.\os;.\inc) DEFINE(LO
                    -G,LIGHT) DEBUG OBJECTEXTEND PRINT(.\Listings\os.lst) TABS(2) OBJECT(.\Objects\os.obj)

line level    source

   1          /**
   2           * @file os.c
   3           * @brief OSç³»ç»Ÿæ–‡ä»¶
   4           * @details è¯¥æ–‡ä»¶å®ç°ä»»åŠ¡çš„åˆ›å»ºï¼Œè°ƒåº¦
   5           * @author mudlife
   6           * @par Copyright (c):
   7           *      ä¸Šæµ·æ™¶æ›¦å¾®ç”µå­ç§‘æŠ€æœ‰é™å…¬å¸
   8           * @version 1.0.0
   9           * @date 2019-06-02
  10           */
  11          #include "os.h"
  12          #include <string.h>
  13          
  14          #define TASK_MAX 4   ///<æœ€å¤šå¯åŒæ—¶è¿è¡Œçš„ä»»åŠ¡ä¸ªæ•°
  15          struct task task_pool[TASK_MAX];///<ä»»åŠ¡æ± 
  16          u8 task_tick;  ///<ä»»åŠ¡æ›´æ–°æ ‡å¿—
  17          
  18           /**
  19           * @brief ä»»åŠ¡åˆå§‹åŒ–
  20           *
  21           * @return æ— 
  22           */
  23          void os_init(void)
  24          {
  25   1      //  memory_init(); //å†…å­˜åˆå§‹åŒ–
  26   1        memset(task_pool,0,sizeof(struct task)*TASK_MAX);
  27   1      }
  28          
  29          
  30          /**
  31           * @brief æ·»åŠ ä»»åŠ¡
  32           *
  33           * @param time ç­‰å¾…å¤šé•¿æ—¶é—´å¼€å§‹æ‰§è¡Œ
  34           * @param fun ä»»åŠ¡å‡½æ•°
  35           * @return æ·»åŠ æˆåŠŸä¸å¦
  36           *   @retval 0 æ·»åŠ æˆåŠŸ
  37           *   @retval 1 æ·»åŠ å¤±è´¥ 
  38           */
  39          u8 os_task_add(u16 time,taskfun fun)
  40          {
  41   1        data u8 i;
  42   1        for(i=0;i<TASK_MAX;i++){
  43   2          if((task_pool[i].sta&0x80) == 0){//åˆ¤æ–­è¯¥ä»»åŠ¡èŠ‚ç‚¹æ˜¯å¦è¢«ä½¿ç”¨  sta çš„ ç¬¬7ä½ ä¸º0 è¡¨ç¤ºæ²¡æ
             -œ‰è¢«ä½¿ç”¨ 
  44   3            task_pool[i].sta = 0x80;
  45   3            task_pool[i].timer = time;
  46   3            task_pool[i].fun = fun;
  47   3            return 0;
  48   3          }
  49   2        }
  50   1        return 1;
  51   1      }
  52          
  53          
C51 COMPILER V9.53.0.0   OS                                                                07/19/2019 10:23:34 PAGE 2   

  54          /**
  55           * @brief è·Ÿæ–°ä»»åŠ¡æ—¶é—´
  56           *
  57           * @return è·Ÿæ–°æˆåŠŸä¸å¦
  58           *   @retval 0 æ›´æ–°æˆåŠŸ
  59           *   @retval 1 æ›´æ–°å¤±è´¥ 
  60           */
  61          u8 os_task_remark(void)
  62          {
  63   1        data u8 i;
  64   1        if(task_tick){
  65   2          task_tick = 0;
  66   2          for(i=0;i<TASK_MAX;i++){
  67   3            if(task_pool[i].timer){
  68   4              task_pool[i].timer--;
  69   4              if(task_pool[i].timer == 0){
  70   5                task_pool[i].sta |=0x01;
  71   5              }
  72   4            }
  73   3          }
  74   2        }
  75   1        return 0;
  76   1      }
  77          
  78          /**
  79           * @brief ä»»åŠ¡è°ƒåº¦
  80           *
  81           * @return è°ƒåº¦æˆåŠŸä¸å¦
  82           *   @retval 0 è°ƒåº¦æˆåŠŸ
  83           *   @retval 1 è°ƒåº¦å¤±è´¥ 
  84           */
  85          u8 os_task_process(void)
  86          {
  87   1        u8 data i;
  88   1        for(i=0;i<TASK_MAX;i++){
  89   2          if((task_pool[i].sta&0x01) != 0){
  90   3            task_pool[i].sta = 0x00;
  91   3            task_pool[i].fun();
  92   3          }
  93   2        }
  94   1        return 0;
  95   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    329    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     25       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
